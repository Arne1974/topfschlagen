<html>

<head>
  <title>Kartenacherei</title>
  <style>
    body {
      margin: 0;
    }

    .spiel {
      display: flex;
      max-width: 980px;
    }

    .space-between {
      justify-content: space-between;
    }

    .space-around {
      justify-content: space-around;
    }

    .center {
      justify-content: center;
    }

    .flex-start {
      justify-content: flex-start;
    }

    .column {
      -webkit-flex-direction: column;
      flex-direction: column;
      float: left;
    }

    .spielfeld {
      width: 600px;
      height: 500px;
      background-color: #e2e2e2;
      position: relative;
    }

    .topf {
      /* display: flex;
      justify-content: center;
      align-items: center; */
      width: 20px;
      height: 20px;
      background-color: orchid;
      position: relative;
      opacity: 0;
    }

    .spielstand {
      display: flex;
      max-height: 250px;
      width: 320px;
      background-color: bisque;
      font-size: 2em;
    }

    .spielstand .klicks,
    .spielstand .hinweis,
    .spielstand .hinweis>*,
    .spielstand .nachricht>* {
      display: flex;
    }

    .spielstand .hinweis,
    .spielstand .nachricht {
      min-height: 37px;
    }

    .hidden {
      display: none !important;
    }
  </style>
</head>

<body>
  <div class="spiel space-between">
    <div class="spielfeld">
      <div class="topf" id="topf"></div>
    </div>
    <div class="spielstand column space-around">
      <div class="klicks space-around">
        <div class="title">Klicks</div>
        <div class="counter">0</div>
      </div>
      <div class="hinweis column space-between">
        <div class="kalt center hidden">Kalt</div>
        <div class="heiss center hidden">Heiss</div>
      </div>
      <div class="nachricht">
        <span class="title center hidden">Gewonnen!</span>
      </div>
    </div>
  </div>
  <script>

    var app = {
      hiddenBox: document.querySelector("#topf"),
      counter: 0,
      isWinner: false,
      topf: {
        x: 10,
        y: 10
      },
      history: [],
      init: function () {
        this.setTopf();
        this.setListener();
      },
      setListener: function () {
        var scope = this;

        document.querySelector(".spielfeld #topf")
          .addEventListener("click", function (event) {
            if (!scope.isWinner) {
              scope.showWinner();
            }
          });

        document.querySelector(".spielfeld")
          .addEventListener("click", function (event) {
            if (!scope.isWinner) {
              if(scope.counter){
                scope.getHinweis(event);
              }
              scope.incrementCounter();

              // console.log('[Spielfeld] clicked: ', scope.counter);
            }
          });
      },
      getRandomIntInclusive: function (min, max) {
        min = Math.ceil(min);
        max = Math.floor(max);
        return Math.floor(Math.random() * (max - min + 1)) + min;
      },
      setTopf: function () {
        this.topf.x = this.getRandomIntInclusive(0, 580);
        this.topf.y = this.getRandomIntInclusive(0, 480);
        
        this.hiddenBox.style.top = this.topf.y;
        this.hiddenBox.style.left = this.topf.x;
      },
      showWinner: function () {
        document.querySelector(".nachricht .title").classList.remove('hidden');
        this.hiddenBox.style.opacity = 1;
        this.isWinner = true;
        document.querySelector(".spielstand .hinweis .kalt").classList.add('hidden');
        document.querySelector(".spielstand .hinweis .heiss").classList.add('hidden');
        // console.log('[Topf] visible!');
      },
      incrementCounter: function () {
        this.counter++;
        document.querySelector(".spielstand .klicks .counter").innerText = this.counter;
      },
      getHinweis: function (evt) {
        var hinweis = this.getHinweisByCoords(evt.screenX, evt.screenY);
        var lastItem = this.history[this.history.length-2];
        
        if (hinweis<lastItem) {
          document.querySelector(".spielstand .hinweis .heiss").classList.remove('hidden');
          document.querySelector(".spielstand .hinweis .kalt").classList.add('hidden')
        } else {
          document.querySelector(".spielstand .hinweis .kalt").classList.remove('hidden');
          document.querySelector(".spielstand .hinweis .heiss").classList.add('hidden');
        }
      },
      getHinweisByCoords: function (clickX, clickY) {
        var temp = Math.sqrt(Math.pow((this.topf.x - clickX), 2) + Math.pow((this.topf.y - clickY), 2));
        this.history.push(temp);
        return temp;
      }
    }

    app.init();
  </script>
</body>

</html>